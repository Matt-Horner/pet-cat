<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>–ü–æ–≥–ª–∞–¥—å –∫–æ—Ç–∏–∫–∞ üê±</title>
  <meta name="theme-color" content="#fff6f9" />
  <style>
    :root{
      --bg:#fff6f9;
      --ink:#3a2e2e;
      --soft:#ffdbe8;
      --accent:#ff7aa2;
      --good:#7ad39e;
      --ok:#ffd86b;
      --shine:#ffe6f2;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
    .wrap{
      min-height:100%;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      align-items:center;
      padding:24px 16px 28px;
      gap:16px;
    }
    header{width:100%;max-width:540px;text-align:center;}
    h1{font-size:22px;margin:0 0 6px;font-weight:700;letter-spacing:0.2px;}
    p.sub{margin:0;font-size:14px;opacity:.8}
    .card{
      width:100%;
      max-width:540px;
      background:white;
      border:1px solid #f3dbe6;
      border-radius:16px;
      box-shadow:0 6px 20px rgba(255,122,162,.12);
      padding:16px;
    }
    .cat-stage{
      position:relative;
      width:100%;
      aspect-ratio:1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border-radius:12px;
      background: radial-gradient(120% 140% at 50% 0%, #fff 0%, #ffeef4 60%, #ffe3ee 100%);
      touch-action:none;
      user-select:none;
      transition:filter .3s ease;
    }
    .cat-stage.party{
      animation:partyBg 3.2s ease-in-out both;
    }
    @keyframes partyBg{
      0%{background:radial-gradient(120% 140% at 50% 0%, #fff 0%, #ffeef4 60%, #ffe3ee 100%)}
      50%{background:radial-gradient(120% 140% at 50% 0%, #fff7e6 0%, #ffe3e9 60%, #eaf9ff 100%)}
      100%{background:radial-gradient(120% 140% at 50% 0%, #fff 0%, #ffeef4 60%, #ffe3ee 100%)}
    }
    .cat-stage.aura{
      box-shadow:inset 0 0 0 2px rgba(255,122,162,.15), 0 0 0 6px rgba(255,122,162,.08);
      animation:auraPulse 1.4s ease-in-out 2;
    }
    @keyframes auraPulse{
      0%{box-shadow:inset 0 0 0 2px rgba(255,122,162,.15), 0 0 0 0 rgba(255,122,162,.0)}
      50%{box-shadow:inset 0 0 0 2px rgba(255,122,162,.15), 0 0 0 20px rgba(255,122,162,.20)}
      100%{box-shadow:inset 0 0 0 2px rgba(255,122,162,.15), 0 0 0 0 rgba(255,122,162,.0)}
    }
    .cat {
      width:82%;
      height:auto;
      transition:transform .15s ease;
    }
    .cat.bounce{ animation:bounce .45s ease-out; }
    @keyframes bounce{
      0%{transform:translateY(0) scale(1)}
      30%{transform:translateY(-6px) scale(1.02)}
      100%{transform:translateY(0) scale(1)}
    }
    .heart{
      position:absolute;
      font-size:18px;
      pointer-events:none;
      will-change: transform, opacity;
      animation: floatUp 900ms ease-out forwards;
      filter: drop-shadow(0 2px 6px rgba(255,122,162,.35));
    }
    @keyframes floatUp{
      from{ transform: translate(-50%,-30%) scale(.8); opacity:.95; }
      to{ transform: translate(-50%,-120px) scale(1.2); opacity:0; }
    }
    .purr{
      position:absolute;
      left:50%;top:50%;
      transform:translate(-50%,-50%);
      width:0;height:0;border-radius:999px;
      border:2px solid rgba(122,211,158,.6);
      animation:pulse 950ms ease-out forwards;
      pointer-events:none;
    }
    @keyframes pulse{
      from{width:10px;height:10px;opacity:.8}
      to{width:160px;height:160px;opacity:0}
    }
    /* –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ */
    .confetti{
      position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;overflow:hidden;
    }
    .confetti i{
      position:absolute;width:8px;height:12px;border-radius:2px;
      background: var(--accent);
      opacity:.95;
      transform:translateY(-20px) rotate(0deg);
      animation:confettiFall 1100ms ease-out forwards;
    }
    @keyframes confettiFall{
      0%{transform:translateY(-20px) rotate(0)}
      100%{transform:translateY(120%) rotate(420deg); opacity:0}
    }
    /* –∫–æ—Ä–æ–Ω–∞ */
    .crown{
      position:absolute;left:50%;top:18%;
      transform:translate(-50%,-120%) rotate(-6deg);
      width:72px;height:auto;opacity:0;pointer-events:none;
      filter: drop-shadow(0 6px 10px rgba(255,216,107,.35));
      transition:opacity .2s ease, transform .35s ease;
    }
    .crown.show{
      opacity:1;
      transform:translate(-50%,-30%) rotate(-6deg);
    }
    /* HUD */
    .hud{
      display:flex;justify-content:space-between;align-items:center;
      gap:10px;margin-top:12px;
      font-size:14px;flex-wrap:wrap;
    }
    .pill{
      background:var(--soft);
      color:var(--ink);
      padding:8px 12px;border-radius:999px;
      border:1px solid #ffd0e0;
      display:flex;align-items:center;gap:8px;
    }
    .pill .dot{width:8px;height:8px;background:var(--good);border-radius:50%;box-shadow:0 0 0 3px rgba(122,211,158,.18);}
    .btn{
      background:var(--accent);
      color:white;
      border:none;border-radius:999px;
      padding:10px 14px;font-weight:600;
      box-shadow:0 8px 18px rgba(255,122,162,.25);
      cursor:pointer;
    }
    .ghost{
      background:transparent;border:1px solid #ffd0e0;color:var(--ink);
      box-shadow:none;
    }
    .msg{
      width:100%;max-width:540px;text-align:center;
      font-size:15px;line-height:1.35;
      padding:8px 12px;margin-top:-6px;color:#5b4a4a;
      min-height:1.2em;
    }
    footer{opacity:.55;font-size:12px}
    .eye{ transform-origin:center; animation:blink 5s infinite; }
    @keyframes blink{
      0%,2%,100%{transform:scaleY(1)}
      1%{transform:scaleY(.05)}
    }
    .pet-shine{ animation:shine .35s ease-in-out; }
    @keyframes shine{
      from{filter:brightness(1)}
      50%{filter:brightness(1.15)}
      to{filter:brightness(1)}
    }
    /* –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ö–∏ */
    .bar{flex:1;min-width:140px;height:10px;background:#ffe8f0;border-radius:999px;overflow:hidden;border:1px solid #ffd0e0}
    .bar > span{display:block;height:100%;width:0%;background:linear-gradient(90deg,#ff9ab7,#ffd86b);transition:width .25s ease}
    /* –≤—Å–ø–ª—ã–≤–∞—à–∫–∏-–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è */
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%) translateY(150%);
      background:#231919;color:#fff;border-radius:12px;padding:12px 14px;font-size:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.22);z-index:30;display:flex;align-items:center;gap:8px;
      transition:transform .35s cubic-bezier(.16,.8,.32,1.1), opacity .35s;
      opacity:0;
    }
    .toast.show{ transform:translateX(-50%) translateY(0); opacity:1; }
    .combo{
      position:absolute;left:50%;top:52%;transform:translate(-50%,-50%);
      font-weight:800;font-size:24px;color:#ff5f93;pointer-events:none;opacity:0;
      animation:comboPop 600ms ease-out forwards; text-shadow:0 6px 16px rgba(255,95,147,.35);
    }
    @keyframes comboPop{
      0%{transform:translate(-50%,-50%) scale(.6);opacity:0}
      30%{transform:translate(-50%,-60%) scale(1.15);opacity:1}
      100%{transform:translate(-50%,-80%) scale(1);opacity:0}
    }
    .hi{font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>–ü–æ–≥–ª–∞–¥—å –∫–æ—Ç–∏–∫–∞ v.2</h1>
      <p class="sub">–ü—Ä–æ–≤–µ–¥–∏ –ø–∞–ª—å—Ü–µ–º –ø–æ –∫–æ—Ç–∏–∫—É ‚Äî –æ–Ω –∑–∞–º—É—Ä—á–∏—Ç –∏ –ø–æ—à–ª—ë—Ç —Å–µ—Ä–¥–µ—á–∫–∏ üíï</p>
    </header>

    <div class="card">
      <div id="stage" class="cat-stage" aria-label="–ö–æ—Ç–∏–∫. –ü–æ–≥–ª–∞–¥—å –º–µ–Ω—è.">
        <!-- –∫–æ—Ä–æ–Ω–∞ -->
        <svg id="crown" class="crown" viewBox="0 0 120 60" aria-hidden="true">
          <path d="M10 48 L20 14 L50 40 L75 8 L102 40 L110 48 Z" fill="#FFD86B" stroke="#D1A400" stroke-width="3"/>
          <circle cx="20" cy="14" r="6" fill="#ff9ab7"/>
          <circle cx="75" cy="8" r="6"  fill="#9ad8ff"/>
          <circle cx="50" cy="40" r="5" fill="#7ad39e"/>
        </svg>

        <svg id="cat" class="cat" viewBox="0 0 200 200" aria-hidden="true">
          <ellipse cx="100" cy="120" rx="60" ry="45" fill="#FFE6EE" stroke="#D8A9BA" stroke-width="2"/>
          <circle cx="100" cy="80" r="36" fill="#FFE6EE" stroke="#D8A9BA" stroke-width="2"/>
          <path d="M75 60 L60 35 L84 48 Z" fill="#FFE6EE" stroke="#D8A9BA" stroke-width="2"/>
          <path d="M125 60 L140 35 L116 48 Z" fill="#FFE6EE" stroke="#D8A9BA" stroke-width="2"/>
          <path d="M74 56 L63 40 L82 49 Z" fill="#FFD0E0"/>
          <path d="M126 56 L137 40 L118 49 Z" fill="#FFD0E0"/>
          <ellipse class="eye" cx="88" cy="80" rx="4.6" ry="4.6" fill="#3A2E2E"/>
          <ellipse class="eye" cx="112" cy="80" rx="4.6" ry="4.6" fill="#3A2E2E"/>
          <polygon points="100,88 95,92 105,92" fill="#ff9ab7"/>
          <path d="M95 92 Q100 96 105 92" stroke="#3A2E2E" stroke-width="1.8" fill="none"/>
          <path d="M70 86 L90 88" stroke="#b68e9e" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M70 94 L90 92" stroke="#b68e9e" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M110 88 L130 86" stroke="#b68e9e" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M110 92 L130 94" stroke="#b68e9e" stroke-width="1.5" stroke-linecap="round"/>
          <ellipse cx="75" cy="150" rx="14" ry="10" fill="#fff" stroke="#D8A9BA" stroke-width="2"/>
          <ellipse cx="125" cy="150" rx="14" ry="10" fill="#fff" stroke="#D8A9BA" stroke-width="2"/>
          <!-- —Ö–≤–æ—Å—Ç –≤ –≥—Ä—É–ø–ø–µ –¥–ª—è ¬´–≤–∏–ª—è–Ω–∏—è¬ª -->
          <g id="tail" transform-origin="158px 120px">
            <path d="M158 120 q18 -6 18 14 q0 18 -18 14" fill="none" stroke="#D8A9BA" stroke-width="8" stroke-linecap="round"/>
          </g>
        </svg>

        <div id="confetti" class="confetti" aria-hidden="true"></div>
      </div>

      <div class="hud">
        <div class="pill"><span class="dot"></span><span id="count">0</span> –ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏–π</div>
        <div class="bar" aria-hidden="true"><span id="progress"></span></div>
        <button id="reset" class="btn" aria-label="–°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç—á–∏–∫">–°–±—Ä–æ—Å–∏—Ç—å</button>
        <button id="share" class="btn ghost" aria-label="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
      </div>
    </div>

    <div id="msg" class="msg" role="status" aria-live="polite"></div>
    <footer>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ö–µ–π—Ç ‚Ä¢ <span class="hi">—Ä–µ–∫–æ—Ä–¥:</span> <span id="best">0</span></footer>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">‚ú® –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!</div>

<script>
(function(){
  const stage = document.getElementById('stage');
  const cat = document.getElementById('cat');
  const tail = document.getElementById('tail');
  const confettiBox = document.getElementById('confetti');
  const crown = document.getElementById('crown');
  const countEl = document.getElementById('count');
  const bestEl = document.getElementById('best');
  const msgEl = document.getElementById('msg');
  const resetBtn = document.getElementById('reset');
  const shareBtn = document.getElementById('share');
  const toastEl = document.getElementById('toast');
  const progressEl = document.getElementById('progress');

  let petCount = 0;
  let best = Number(localStorage.getItem('petBest') || 0);
  bestEl.textContent = best;
  let last = null;
  let distAccum = 0;
  let lastPetAt = 0;
  let combo = 0;

  const PET_THRESHOLD = 300;    // —Å–∫–æ–ª—å–∫–æ –ø–∏–∫—Å–µ–ª–µ–π –ø—Ä–æ–≤–µ—Å—Ç–∏, —á—Ç–æ–±—ã –∑–∞—Å—á–∏—Ç–∞–ª–æ—Å—å ¬´–ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ¬ª
  const COMBO_WINDOW = 520;    // –º—Å –º–µ–∂–¥—É –ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è–º–∏ –¥–ª—è –∫–æ–º–±–æ

  const messages = [
    "–°–ø–∞—Å–∏–±–æ, –º–Ω–µ —Ç–∞–∫ –ø—Ä–∏—è—Ç–Ω–æ üò∫",
    "–¢—ã –¥–µ–ª–∞–µ—à—å —ç—Ç–æ—Ç –º–∏—Ä –º—è–≥—á–µ üíû",
    "–ï—â—ë —á—É—Ç—å-—á—É—Ç—å ‚Äî –∏ —è –∑–∞–º—É—Ä—á—É –≥—Ä–æ–º—á–µ üíö",
    "–¢—ã —Å–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è –ª—É—á—à–µ, —á–µ–º –¥—É–º–∞–µ—à—å.",
    "–ü—É—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –ª–µ–≥—á–µ üí´",
    "–ì–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö‚Ä¶ –∏ –≤—ã–¥–æ—Ö. –£–∂–µ –ª—É—á—à–µ."
  ];

  // –≤–µ—Ö–∏ –∏ —Å–ø–µ—Ü-—ç—Ñ—Ñ–µ–∫—Ç—ã
  const milestones = {
    3:  { text:"–ö–æ—Ç–∏–∫ —É—Ä—á–∏—Ç –¥–æ–≤–æ–ª—å–Ω–µ–µ‚Ä¶ –ø—Ä–æ–¥–æ–ª–∂–∞–π ü•∞", effect: aura },
    5:  { text:"–°—É–ø–µ—Ä —Ç–µ–º–ø! ‚ú®", effect: bounce },
    10: { text:"–í–∞—É! –ö–æ—Ç–∏–∫ –∞–±—Å–æ–ª—é—Ç–Ω–æ —Å—á–∞—Å—Ç–ª–∏–≤! üåà", effect: confettiBurst },
    15: { text:"–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –º—É—Ä—á–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ üé∂", effect: party },
    20: { text:"–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å! üëë", effect: crownShow },
    30: { text:"–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! –°–µ—Ä–¥–µ—á–Ω–∞—è –º–µ—Ç–µ–ª—å üíñ", effect: megaBurst }
  };

  function rnd(min,max){ return Math.random()*(max-min)+min; }

  function spawnHeart(x,y){
    const h = document.createElement('div');
    h.className = 'heart';
    h.textContent = Math.random()<0.6 ? 'üíó' : (Math.random()<0.5 ? 'üíñ' : 'üíû');
    h.style.left = x+'px';
    h.style.top = y+'px';
    h.style.fontSize = (16 + rnd(0,10))+'px';
    stage.appendChild(h);
    h.addEventListener('animationend',()=>h.remove());
  }

  function purr(){
    const ring = document.createElement('div');
    ring.className='purr';
    stage.appendChild(ring);
    setTimeout(()=>ring.remove(),950);
    if (navigator.vibrate) navigator.vibrate(10);
    // –ª—ë–≥–∫–æ–µ ¬´–≤–∏–ª—è–Ω–∏–µ¬ª —Ö–≤–æ—Å—Ç–æ–º
    tail.animate(
      [{transform:'rotate(0deg)'},{transform:'rotate(12deg)'},{transform:'rotate(0deg)'}],
      {duration:350, easing:'ease-out'}
    );
  }

  function setMessage(text){ msgEl.textContent = text; }

  function showToast(text){
    toastEl.textContent = text;
    toastEl.classList.add('show');
    setTimeout(()=>toastEl.classList.remove('show'), 1500);
  }

  function aura(){ stage.classList.add('aura'); setTimeout(()=>stage.classList.remove('aura'),1400); }
  function bounce(){ cat.classList.add('bounce'); setTimeout(()=>cat.classList.remove('bounce'),450); }
  function party(){
    stage.classList.add('party');
    setTimeout(()=>stage.classList.remove('party'),3200);
    if (navigator.vibrate) navigator.vibrate([20,60,20]);
  }
  function crownShow(){
    crown.classList.add('show');
    setTimeout(()=>crown.classList.remove('show'),1800);
  }

  function confettiBurst(amount=26){
    for(let i=0;i<amount;i++){
      const p = document.createElement('i');
      const hue = Math.round(rnd(330, 420)) % 360; // —Ç—ë–ø–ª—ã–µ-—Ä–æ–∑–æ–≤—ã–µ
      p.style.background = `hsl(${hue}, 85%, 70%)`;
      p.style.left = rnd(5,95)+'%';
      p.style.top = rnd(-10,10)+'%';
      p.style.width = rnd(6,10)+'px';
      p.style.height = rnd(10,16)+'px';
      p.style.animationDelay = rnd(0,120)+'ms';
      confettiBox.appendChild(p);
      p.addEventListener('animationend',()=>p.remove());
    }
  }
  function megaBurst(){
    confettiBurst(50);
    // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ ‚Äî 12 —Å–µ—Ä–¥–µ—Ü –∏–∑ —Ü–µ–Ω—Ç—Ä–∞
    const rect = stage.getBoundingClientRect();
    for(let i=0;i<12;i++){
      spawnHeart(rect.width/2, rect.height/2);
    }
    if (navigator.vibrate) navigator.vibrate([30,80,30,80,30]);
  }

  function updateProgress(){
    // –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–º–µ—Ç–Ω–æ–π –≤–µ—Ö–∏: 3,5,10,15,20,30, –∑–∞—Ç–µ–º –∫–∞–∂–¥—ã–µ +10
    const steps = [3,5,10,15,20,30];
    let next = steps.find(s=>s>petCount) ?? (Math.floor(petCount/10)*10 + 10);
    let prev = 0;
    for (const s of steps) { if (s<=petCount) prev = s; }
    if (petCount>=30){ prev = Math.floor(petCount/10)*10; }
    const w = Math.min(100, Math.round((petCount - prev) / (next - prev) * 100));
    progressEl.style.width = w + '%';
    progressEl.title = `–î–æ —Å–ª–µ–¥—É—é—â–µ–π —Ä–∞–¥–æ—Å—Ç–∏: ${Math.max(0, next - petCount)}`;
  }

  function comboPop(n){
    if (n<2) return;
    const el = document.createElement('div');
    el.className = 'combo';
    el.textContent = `√ó${n} –∫–æ–º–±–æ!`;
    stage.appendChild(el);
    setTimeout(()=>el.remove(),600);
  }

  function addPet(now = performance.now()){
    // –∫–æ–º–±–æ
    if (now - lastPetAt <= COMBO_WINDOW) combo++;
    else combo = 1;
    lastPetAt = now;

    petCount += 1;
    countEl.textContent = petCount;

    stage.classList.remove('pet-shine'); void stage.offsetWidth; stage.classList.add('pet-shine');
    cat.classList.remove('bounce');

    // —Å–æ–æ–±—â–µ–Ω–∏—è
    if (milestones[petCount]) {
      setMessage(milestones[petCount].text);
      milestones[petCount].effect?.();
      showToast(milestones[petCount].text);
    } else {
      setMessage(messages[Math.floor(Math.random()*messages.length)]);
    }

    // –≤–∏–∑—É–∞–ª–∫–∏ –∏ —Ç–∞–∫—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    purr();
    bounce();
    comboPop(combo);

    // –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ä–µ–∫–æ—Ä–¥
    updateProgress();
    if (petCount > best){
      best = petCount;
      bestEl.textContent = best;
      localStorage.setItem('petBest', String(best));
    }
  }

  function handleDown(clientX, clientY){
    last = {x:clientX, y:clientY};
    distAccum = 0;
    const rect = stage.getBoundingClientRect();
    spawnHeart(clientX - rect.left, clientY - rect.top);
  }

  function handleMove(clientX, clientY){
    if(!last) return;
    const dx = clientX - last.x;
    const dy = clientY - last.y;
    const step = Math.hypot(dx,dy);
    distAccum += step;
    last = {x:clientX, y:clientY};

    if (distAccum >= PET_THRESHOLD){
      distAccum = 0;
      addPet();
      const rect = stage.getBoundingClientRect();
      spawnHeart(clientX - rect.left, clientY - rect.top);
      // –Ω–µ–±–æ–ª—å—à–æ–µ ¬´–≤–∏–ª—è–Ω–∏–µ¬ª –≤—Å–µ–π —Å—Ü–µ–Ω—ã –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –¥–≤–∏–∂–µ–Ω–∏—è—Ö
      stage.animate([{filter:'brightness(1)'},{filter:'brightness(1.08)'},{filter:'brightness(1)'}],{duration:250});
    }
  }

  function handleUp(){
    last = null;
    distAccum = 0;
  }

  // –∂–µ—Å—Ç—ã
  stage.addEventListener('touchstart', e=>{
    const t = e.changedTouches[0];
    handleDown(t.clientX, t.clientY);
  }, {passive:true});
  stage.addEventListener('touchmove', e=>{
    const t = e.changedTouches[0];
    handleMove(t.clientX, t.clientY);
  }, {passive:true});
  stage.addEventListener('touchend', handleUp);
  stage.addEventListener('touchcancel', handleUp);

  let mouseDown=false;
  stage.addEventListener('mousedown', e=>{ mouseDown=true; handleDown(e.clientX,e.clientY); });
  window.addEventListener('mousemove', e=>{ if(mouseDown) handleMove(e.clientX,e.clientY); });
  window.addEventListener('mouseup', ()=>{ mouseDown=false; handleUp(); });

  // –∫–Ω–æ–ø–∫–∏
  resetBtn.addEventListener('click', ()=>{
    petCount = 0;
    countEl.textContent = '0';
    setMessage("–°–Ω–∞—á–∞–ª–∞ ‚Äî –º—è–≥–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ üêà");
    updateProgress();
    crown.classList.remove('show');
  });

  shareBtn.addEventListener('click', async ()=>{
    const text = `–Ø –ø–æ–≥–ª–∞–¥–∏–ª(–∞) –∫–æ—Ç–∏–∫–∞ ${petCount} —Ä–∞–∑ üò∫`;
    if (navigator.share) {
      try { await navigator.share({title:'–ü–æ–≥–ª–∞–¥—å –∫–æ—Ç–∏–∫–∞', text}); }
      catch(e){}
    } else {
      await navigator.clipboard.writeText(text);
      showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ üìã');
    }
  });

  // –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  setTimeout(()=>setMessage("–ü—Ä–æ–≤–µ–¥–∏ –ø–∞–ª—å—Ü–µ–º –ø–æ –∫–æ—Ç–∏–∫—É ‚Äî –æ–Ω –ª—é–±–∏—Ç –Ω–µ–∂–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è ü´∂"),400);
  updateProgress();

  // –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ ‚Äî –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–ø—Ä–æ–±–µ–ª/Enter)
  window.addEventListener('keydown', (e)=>{
    if (e.key === ' ' || e.key === 'Enter'){
      e.preventDefault();
      addPet();
    }
  });
})();
</script>
</body>
</html>
